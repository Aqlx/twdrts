(()=>{"use strict";const t=class{constructor(t){this.el=document.getElementById(t)}show(){this.el.classList.add("md-show")}hide(){this.el.classList.remove("md-show")}toggle(){this.el.classList.toggle("md-show")}},e=class{constructor(t){this.el=document.getElementById(t),this.tabs=this.el.querySelectorAll("[data-tab]"),this.tabContents=this.el.querySelectorAll("[data-tab-content]"),this.iniEvent()}iniEvent(){for(let t=0;t<this.tabs.length;t++)this.tabs[t].onclick=()=>{for(let t=0;t<this.tabs.length;t++)this.tabs[t].classList.remove("active");const e=this.tabs[t].dataset.tab;this.tabs[t].classList.add("active"),this.showContent(e)}}showContent(t){for(let t=0;t<this.tabContents.length;t++)this.tabContents[t].classList.remove("show");document.querySelector(`[data-tab-content=${t}]`).classList.add("show")}},s=class{constructor(t){this.el=document.getElementById(t),this.bottons=this.el.querySelectorAll("button"),this.active=[],[].forEach.call(this.bottons,(t=>{t.onclick=()=>{const e=t.dataset.trait;if(e.match(/all|melee|range/)){let t=this.active.length;for(;t--;)this.remove(this.active[t])}else{if(!e.match(/fast|strong|alert|tough/))return!1;{let t=this.active.length;for(;t--;)this.active[t].match(/fast|strong|alert|tough/)||this.remove(this.active[t])}}this.toggle(t)}}))}toggle(t){const e=t.dataset.trait;t.classList.toggle("active");const s=this.active.indexOf(e);return-1==s?this.active.push(e):this.active.splice(s,1),this}remove(t){const e=this.active.indexOf(t),s=this.el.querySelector(`[data-trait=${t}]`);this.active.splice(e,1),s.classList.remove("active")}},a={apAtttack:20,methodAPMultiple:{atk:1,def:1.4},bg:{fast:"#c18c00",strong:"#415c1c",alert:"#981014",tough:"#003466"}};({state:{leaderAP:0,towerAP:0,member:[]},init(){this.defineEl().iniEvents().iniModal().mergeOptions().bootstrap().calculateAll()},mergeOptions(){return this.state={...this.state,method:"atk",member:[{trait:"fast"},{trait:"strong"},{trait:"alert"},{trait:"tough"},{trait:"fast"}]},this},defineEl(){return this.el={modalSetAPBuff:new t("modal-set-ap-buff"),leaderTrait:new s("leader-trait"),towerTrait:new s("tower-trait"),selectTraits:document.querySelectorAll('[data-el="select-trait"]'),showBuffLeader:document.getElementById("show-buff-leader"),showBuffTower:document.getElementById("show-buff-tower")},this},iniEvents(){for(let t=0;t<this.el.selectTraits.length;t++){const e=this.el.selectTraits[t].nextElementSibling;this.el.selectTraits[t].onclick=()=>{e.classList.toggle("show")};const s=e.querySelectorAll("li");for(let a=0;a<s.length;a++)s[a].onclick=()=>{const l=s[a].dataset.trait;this.state.member[t].trait!==l&&this.setTrait(t,l),e.classList.remove("show")}}document.getElementById("buff").onclick=()=>{this.el.modalSetAPBuff.show()},document.getElementById("btn-apply-buff").onclick=()=>{this.applyBuff()};const t=document.querySelectorAll('input[name="method"]');[].slice.call(t).forEach((t=>{t.onchange=()=>{this.calculateAll()}}));const e=document.querySelectorAll('select[name="ipt-ap"]');for(let t=0;t<e.length;t++)e[t].onchange=()=>{this.calculateAP(t)};const s=document.querySelectorAll('select[name="weapon-ap"]');for(let t=0;t<s.length;t++)s[t].onchange=()=>{this.calculateAP(t)};const a=document.querySelectorAll('input[name="wap8a"]');for(let t=0;t<a.length;t++)a[t].onchange=()=>{if("fast"===this.state.member[t].trait){const e=document.getElementById(`chk-wap20-${t}`);e.checked&&(e.checked=!1)}this.calculateAll()};const l=document.querySelectorAll('input[name="wap20"]');for(let t=0;t<l.length;t++)l[t].onchange=()=>{if("fast"===this.state.member[t].trait){const e=document.getElementById(`chk-wap8a-${t}`);e.checked?(e.checked=!1,this.calculateAll()):this.calculateAP(t)}else this.calculateAP(t)};const i=document.querySelectorAll('input[name="ap-gain"]');for(let t=0;t<i.length;t++)i[t].oninput=function(){this.value>100&&(this.value=100)},i[t].onkeyup=()=>{this.calculateAP(t)};return this},iniModal(){return document.getElementById("btn-close-md").onclick=()=>{this.el.modalSetAPBuff.hide()},new e("tab-buff"),this},bootstrap(){document.getElementById(`method-${this.state.method}`).checked=!0;for(let t=0;t<this.state.member.length;t++)this.setTrait(t,this.state.member[t].trait);return this},setTrait(t,e){this.el.selectTraits[t].className=this.el.selectTraits[t].className.replace(/fast|strong|alert|tough/,e),document.getElementById(`m${t}`).style.backgroundColor=a.bg[e];const s=document.getElementById(`wap8a-${t}`),l=document.getElementById(`wap20-${t}`),i=document.getElementById(`chk-wap8a-${t}`),c=document.getElementById(`chk-wap20-${t}`);i.checked=!1,c.checked=!1,{fast(){s.classList.remove("hide"),l.classList.remove("hide")},strong(){s.classList.remove("hide"),l.classList.add("hide")},alert(){s.classList.add("hide"),l.classList.add("hide")},tough(){s.classList.add("hide"),l.classList.remove("hide")}}[e](),this.state.member[t].trait=e,this.calculateAll()},applyBuff(){this.state.leaderAP=this._applyBuff(this.el.showBuffLeader,this.el.leaderTrait,'input[name="iptl-apa"]:checked'),this.state.towerAP=this._applyBuff(this.el.showBuffTower,this.el.towerTrait,'input[name="iptt-apa"]:checked'),this.el.modalSetAPBuff.hide(),this.calculateAll()},_applyBuff(t,e,s){t.innerHTML="";for(let s=0;s<e.active.length;s++){const a=e.active[s];if(a.match(/all|melee|range/))t.innerHTML+=`<span class="clr-amber">${a}</span> `;else{if(!a.match(/fast|strong|alert|tough/))return!1;t.innerHTML+=`<i class="icon icon-trait i-sm icon-trait-${a}"></i> `}}const a=document.querySelector(s).dataset.txt;return t.innerHTML+=`<span class="clr-lightyellow">${a}</span> AP Atk`,parseFloat(document.querySelector(s).value)},getAPLeader(t){return this.getAPfromBuff(t,this.el.leaderTrait.active,this.state.leaderAP)},getAPTower(t){return this.getAPfromBuff(t,this.el.towerTrait.active,this.state.towerAP)},getAPfromBuff(t,e,s){if("all"===e[0])return s;if("melee"===e[0]&&this.state.member[t].trait.match(/fast|strong/))return s;if("range"===e[0]&&this.state.member[t].trait.match(/alert|tough/))return s;for(let a=0;a<e.length;a++)if(e[a]===this.state.member[t].trait)return s;return 0},getRechargeRate:t=>parseInt(document.getElementById(`ipt-ap${t}`).value,10),getAPWeapon:t=>parseFloat(document.getElementById(`w${t}`).value),getAPReceived(t){const e=parseInt(document.getElementById(`ipt-gain${t}`).value,10)||0,s=this.getAPPercentage(this.getRechargeRate(t),e),a=document.getElementById(`apg${t}`);return s?(a.classList.add("show"),a.innerHTML=`+${s}`):a.classList.remove("show"),s},getAPWeapon8All(t){const e=document.querySelectorAll('input[name="wap8a"]:checked');let s=0;for(let a=0;a<e.length;a++){const l=parseInt(e[a].value,10);s+=this.getAPPercentage(this.getRechargeRate(t),l)}const a=document.getElementById(`apw8a-${t}`);return s?(a.classList.add("show"),a.innerHTML=`+${s}`):a.classList.remove("show"),s},getAPWeapon20(t){if(this.state.member[t].trait.match(/fast|tough/)){const e=document.getElementById(`chk-wap20-${t}`),s=document.getElementById(`apw20-${t}`);if(e.checked){const a=parseInt(e.value,10),l=this.getAPPercentage(this.getRechargeRate(t),a);return l&&(s.classList.add("show"),s.innerHTML=`+${l}`),l}return s.classList.remove("show"),0}return 0},getMethod:()=>parseFloat(a.methodAPMultiple[document.querySelector('input[name="method"]:checked').value]),getAPPercentage:(t,e)=>Math.ceil(t*parseInt(e,10)/100),calculateAll(){for(let t=0;t<=4;t++)this.calculateAP(t)},calculateAP(t){this.report(t,this.calculateNode(t),this.getAPReceived(t)+this.getAPWeapon8All(t)+this.getAPWeapon20(t))},calculateNode(t){return parseFloat(((a.apAtttack+this.getAPLeader(t)+this.getAPTower(t)+this.getAPWeapon(t))*this.getMethod()).toFixed(2))},report(t,e,s){this.reportFT(t,e,s),this.reportApPerTurn(t,e)},reportFT(t,e,s){const a=document.getElementById(`rft${t}`),l=this.getRechargeRate(t);let i=0,c=0;for(;c<l;)c+=e,i++;if(s){let t=0;for(;s<l;)s+=e,t++;a.innerHTML=t}else a.innerHTML=i},reportApPerTurn(t,e){document.getElementById(`apt${t}`).innerHTML=e}}).init()})();