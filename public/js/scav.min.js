"use strict";var xpFromScav=1e5,campMember=[],name="",star=5,tier=4,lvl=1,xp=0,countMember=0,xpPerMember=0,maxLvl=80,eName=document.getElementById("ipt-name"),eLblLvl=document.getElementById("lbl-lvl"),eInputLvl=document.getElementById("range-lvl"),eGroupStar=document.getElementById("g-star"),eGroupTier=document.getElementById("g-tier"),eBtnStar=eGroupStar.getElementsByTagName("button"),eBtnTier=eGroupTier.getElementsByTagName("button"),btnAddtoCamp=document.getElementById("btn-addtocamp"),camp=document.getElementById("camp"),campNodes=camp.getElementsByTagName("li"),eXP=document.getElementById("ipt-xp");eName.onchange=function(){name=this.value},eXP.oninput=function(){this.value.length>4&&(this.value=this.value.slice(0,4))},eXP.onclick=function(){this.select()},eXP.onkeyup=function(){xp=parseInt(this.value||0,10)},eInputLvl.oninput=function(){eLblLvl.value=lvl=parseInt(this.value)},eLblLvl.onclick=function(){this.select()},eLblLvl.onkeyup=function(){this.value>maxLvl&&(eLblLvl.value=maxLvl),eInputLvl.value=lvl=parseInt(this.value||1,0)};for(var i=0;i<eBtnStar.length;i++)eBtnStar[i].onclick=function(){for(var e=0;e<eBtnStar.length;e++)eBtnStar[e].classList.remove("active");this.classList.add("active"),star=parseInt(this.dataset.value,10),setMaxLevel()};for(var _i=0;_i<eBtnTier.length;_i++)eBtnTier[_i].onclick=function(){for(var e=0;e<eBtnTier.length;e++)eBtnTier[e].classList.remove("active");this.classList.add("active"),tier=parseInt(this.dataset.value,10),setMaxLevel()};var addToCamp=function(e){for(var t=void 0,n=0;n<5;n++)if(!campNodes[n].hasChildNodes()){t=n;break}e.idx=t,campMember[t]=e;var a=document.createElement("div");a.className="fill",a.appendChild(addBtnRemove(t)),a.appendChild(addTier(e.tier)),a.appendChild(createTable(e)),campNodes[t].appendChild(a),countMember++,calculate()},addBtnRemove=function(e){var t=document.createElement("span");return t.className="close",t.innerHTML="&times;",t.idx=e,t.addEventListener("click",removeMember,!1),t},addTier=function(e){var t=document.createElement("div");t.className="tier-wrapper";for(var n=0;n<e;n++){var a=document.createElement("span");a.className="tier",t.appendChild(a)}return t},createTable=function(e){var t=document.createElement("table"),n=function(e){for(var t=document.createElement("tr"),n=0;n<e.length;n++)t.appendChild(e[n]);return t},a=function(e){var t=document.createElement("span");return t.id=e,t},l=function(e,t){var n=document.createElement("td");return""===e&&(e="&nbsp;"),n.innerHTML=e,t&&(t.colspan&&n.setAttribute("colspan",t.colspan),t.id&&n.appendChild(a(t.id)),t.className&&(n.className=t.className)),n};return t.appendChild(n([l(e.name,{colspan:2,className:"text-center"})])),t.appendChild(n([function(e){var t=document.createElement("td");t.setAttribute("colspan",2),t.className="text-center",6===e&&(t.className+=" clr-amber");for(var n=0;n<e;n++){var a=document.createElement("i");a.className="fa fa-star",t.appendChild(a)}return t}(e.star)])),t.appendChild(n([l("lvl",{className:"text-right"}),l(e.lvl+" > ",{id:"lvl-"+e.idx,className:"clr-success"})])),t.appendChild(n([l("xp",{className:"text-right"}),l(null,{id:"xp-"+e.idx})])),t.appendChild(n([l("xp gain",{className:"text-right"}),l(null,{id:"xp-gain-"+e.idx})])),t.appendChild(n([l("renown",{className:"text-right"}),l(null,{id:"renown-"+e.idx,className:"clr-amber"})])),t},removeMember=function(e){for(var t=e.target.idx,n=campNodes[t];n.firstChild;)n.removeChild(n.firstChild);countMember--,campMember[t]=null,calculate()},getXpPerMember=function(){return parseInt(xpFromScav/countMember,10)},getRemainingXpChart=function(e){return Xp["s"+campMember[e].star]["t"+campMember[e].tier].slice(campMember[e].lvl-1)},getRenownPoint=function(e,t){return Renown["s"+campMember[e].star][campMember[e].tier-1]*t},setResult=function(e,t){var n=document.getElementById("lvl-"+e),a=document.getElementById("xp-"+e),l=document.getElementById("xp-gain-"+e),r=document.getElementById("renown-"+e);n.innerHTML=campMember[e].lvl+t.lvlGain,a.innerHTML=t.xp.toLocaleString(),"max"===t.xp?a.className="clr-red":a.className="",l.innerHTML=t.xpGain.toLocaleString(),r.innerHTML=getRenownPoint(e,t.lvlGain).toLocaleString()},setTotal=function(e){document.getElementById("total").innerHTML=e.toLocaleString()},totalRenown=0,setSummary=function(e){totalRenown+=e},setMaxLevel=function(){maxLvl=MaxLevel["s"+star]["t"+tier],eInputLvl.setAttribute("max",maxLvl),eLblLvl.value>maxLvl&&(eLblLvl.value=lvl=maxLvl)},calculate=function(){xpPerMember=getXpPerMember(),totalRenown=0;for(var e=0;e<=4;e++)if(campMember[e]){var t=calculateMember(e);setResult(e,t),totalRenown+=getRenownPoint(e,t.lvlGain)}setTotal(totalRenown)},calculateMember=function(e){var t=getRemainingXpChart(e),n=0,a=0,l=0;if(t.length){t[0]=t[0]-campMember[e].xp;for(var r=0;r<t.length;r++){if((n+=t[r])>xpPerMember){a=r,l=xpPerMember+t[r]-n,n=xpPerMember;break}a=r+1,l="max"}}return{lvlGain:a,xp:l,xpGain:n}};btnAddtoCamp.onclick=function(){if(5===countMember)return!1;addToCamp({name:name,star:star,tier:tier,lvl:lvl,xp:xp})};